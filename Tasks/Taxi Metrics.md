# Метрики такси 
У меня есть результаты предсказаний двух моделей. Мне необходимо провести анализ и вывести метрики, которые помогут оценить точность моделей по различным параметрам.

## Mean Squared Error (MSE)

$$
\text{MSE} = \frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2
$$

```python
MSE = ((df['target'] - df['prediction']) ** 2).sum() / len(df)
```

**MSE** для первой модели `99 994`.

**MSE** для второй модели `124 936`.

Для лучшего восприятия я вычислил **RMSE**
```python
MSE **= 1/2
```
**RMSE** первой модели `316`.

**RMSE** второй модели `353`.

На первый взгляд, сразу можно сказать, что у второй модели глубина ошибки больше чем у первой. Из чего можно получить, что у второй модели разброс ошибок на  `11%` больше относительно первой.

По показателям **MSE** первая модель лучше.

## Mean Absolute Error(MAE)

$$
\text{MAE} = \frac{1}{n} \sum_{i=1}^{n} |y_i - \hat{y}_i|
$$

```python
MAE = abs((df['trip_duration'] - df['prediction_1'])).sum() / len(df)
```

**MAE** для первой модели `300`.

**MAE** для второй модели `281`.

По метрики **MAE** уже выйгрывает вторая модель, в среднем она допускает на `6%` меньше ошибок, относительно первой. 

Для того, чтобы посчитать, у какой модели глубина ошибок больше, определим за фатальное отклонение `500` и посчитаем количество отклонений для каждой модели.

```python
counter_error = (df['trip_duration'] - df['prediction_'] >= 500).sum()  
```
Первая модель допустила грубых ошибок `0`.

Вторая модель допустила грубых ошибок `84524`.

Теперь видно, что вторая модель чаще допускает фатальные ошибки. 

Чтобы посчитать процент грубых ошибок относительно всех предсказаний, я сделаю следующее.

```python
counter_error * 100 / len(df)
```

Получил значение равное `6%`. Это говорит нам следуюющее - `6%` предсказаний будут содержать грубые ошибки.

## RMSLE (Root Mean Squared Logarithmic Error)

$$
\text{RMSLE}(X, y, a) = \sqrt{\frac{1}{\ell}\sum_{i=1}^{\ell} \big(\log{(y_i + 1)} - \log{(a(x_i) + 1)}\big)^2}
$$

Прежде чем перейти к рассчету RMSLE, важно заметить, что логарфимирование возможно только для значений `>0`. Анализируя данные, я обнаружил, что предсказания первой 
модели содержат `5` отрицательных предскаазаний, а второй `93905`. Для того, чтобы избежать отрицательных значений применяю метод `clip(lower=0)`, тем самым заменяю все отрицательные значения на `0`. 

```python
RMSLE = round(np.sqrt(((np.log1p(df['prediction'].clip(lower=0)) - np.log1p(df['trip_duration'].clip(lower=0))) ** 2).sum() / len(df)), 3)
```

**RMSLE** первой модели `0.554`

**RMSLE** второй модели `1.556`

**RMSLE** учитывает отностельность ошибки, что помгает более качественно оценить модель. Первая модель выйгрывает по метрки вторую. Во второй модели `6,5%` предсказаний были отрицательными, что является грубой ошибкой. 

> Вторая модель допустила грубых ошибок `84524`.

Ранее мы определили для предсказаний отклонения больше `500` как грубую ошибку, но не учитывали, что модель может принимать отрицательные значения. Если учесть и это, то во второй модели `178 429` грубых ошибок, а это `12,23%` грубых ошибок от всех предсказаний второй модели. В первой отрицательных значений `5`, что для `1458644` предсказаний является незначительной ошибкой.








